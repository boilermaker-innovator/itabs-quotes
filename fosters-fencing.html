<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How much will my fence cost? | Fosters Fencing Perth</title>

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:title" content="How much will my fence cost? | Fosters Fencing Perth">
<meta property="og:description" content="Get a ballpark price in 60 seconds. Colorbond, aluminium, timber & more. No login, no spam â€” just numbers. 5.0â˜… from 141 Google reviews.">
<meta property="og:image" content="https://boilermaker-innovator.github.io/itabs-quotes/og-fosters-fencing.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:url" content="https://boilermaker-innovator.github.io/itabs-quotes/fosters-fencing.html">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="How much will my fence cost? | Fosters Fencing Perth">
<meta name="twitter:description" content="Get a ballpark price in 60 seconds. Colorbond, aluminium, timber & more. No login, no spam â€” just numbers.">
<meta name="twitter:image" content="https://boilermaker-innovator.github.io/itabs-quotes/og-fosters-fencing.png">

<!-- General -->
<meta name="description" content="Instant fencing quote estimator for Perth. Colorbond, aluminium slat, timber, pool & security fencing. Get a ballpark price in 60 seconds from Fosters Fencing Perth.">
<meta name="theme-color" content="#4ade80">

<script>
const WIDGET_CONFIG = {

  business: {
    name: "Fosters Fencing Perth",
    tagline: "Colorbond, Aluminium & Timber Fencing Specialists",
    phone: "08 9343 6595",
    email: "",
    logo: "",
    website: "https://fostersfencing.com.au",
    location: "Perth, WA",
    socials: { facebook: "", instagram: "", google: "" }
  },

  branding: {
    mode: "dark",
    primaryColor: "#4ade80",
    secondaryColor: "#22c55e",
    backgroundColor: "#0a1210",
    cardBackground: "#111f1a",
    hoverBackground: "#162b23",
    darkBackground: "#070e0b",
    borderColor: "#1c3329",
    textColor: "#e8f0ec",
    mutedText: "#88a79a",
    dimText: "#5a7d6d",
    successColor: "#4ade80",
    errorColor: "#ef4444",
    infoColor: "#38bdf8",
    fontFamily: "'Plus Jakarta Sans', sans-serif",
    monoFont: "'JetBrains Mono', monospace",
    borderRadius: "14px",
    googleFontsUrl: "https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap",
  },

  header: {
    icon: "ğŸ›¡ï¸",
    headline: "How much will my fence cost?",
    subtitle: "Get a ballpark price from Fosters Fencing in about 60 seconds. No login, no spam â€” just numbers.",
    badge: "ğŸ“ Perth, WA â€” 2025 pricing",
    disclaimer: "Estimates are approximate. Final pricing confirmed after free site inspection.",
  },

  steps: [
    // â”€â”€ STEP 1: Fence Type â”€â”€
    {
      id: "fence_type",
      title: "What type of fence?",
      preview: "Tap to choose",
      input: {
        type: "select",
        columns: 1,
        autoAdvance: true,
        options: [
          {
            value: "colorbond",
            label: "Colorbond",
            icon: "ğŸ”©",
            description: "Genuine Bluescope Steel with 10-year warranty. Perth's most popular fence â€” low maintenance, private, 20+ colours. Fosters' specialty.",
            priceHint: "$95â€“$130/m",
            tags: [
              { text: "Most Popular", highlight: true },
              { text: "Bluescope 10yr warranty" }
            ]
          },
          {
            value: "aluminium",
            label: "Aluminium Slat",
            icon: "âœ¨",
            description: "Modern, sleek look with great airflow. Won't rust â€” ideal for coastal suburbs. Privacy or semi-privacy options. Lasts 50+ years.",
            priceHint: "$180â€“$300/m",
            tags: [
              { text: "Premium" },
              { text: "Coastal proof" }
            ]
          },
          {
            value: "timber",
            label: "Timber Paling",
            icon: "ğŸªµ",
            description: "Classic natural look. Cheaper upfront but needs staining every few years. Treated pine lasts 15â€“20 years.",
            priceHint: "$120â€“$200/m",
            tags: [
              { text: "Natural look" },
              { text: "More upkeep" }
            ]
          },
          {
            value: "pool",
            label: "Pool Fencing",
            icon: "ğŸŠ",
            description: "Glass, aluminium tubular, or perforated panels. Must comply with AS1926.1 safety standards. Building permit required in WA.",
            priceHint: "$200â€“$600/m",
            tags: [
              { text: "Safety compliance" },
              { text: "Permit required" }
            ]
          },
          {
            value: "security",
            label: "Security Fencing",
            icon: "ğŸ”’",
            description: "Garrison-style steel palisade or chain mesh with barbed wire. For properties needing serious perimeter security.",
            priceHint: "$110â€“$250/m",
            tags: [
              { text: "High security" },
              { text: "Commercial & residential" }
            ]
          }
        ]
      },
      hints: [
        {
          tabLabel: "Compare",
          type: "comparison_table",
          columns: ["Feature", "Colorbond", "Aluminium", "Timber"],
          rows: [
            ["Privacy", "Full", "Varies", "Full"],
            ["Maintenance", "Minimal", "Minimal", "Regular"],
            ["Lifespan", "20â€“25 yrs", "50+ yrs", "15â€“20 yrs"],
            ["Coastal safe?", "OK", "Best", "Risky"],
            ["Termite risk?", "None", "None", "Yes"],
            ["Bushfire rated?", "Yes (BAL)", "Yes", "No"],
          ],
          cellStyles: {
            "Minimal": "positive", "None": "positive", "Yes (BAL)": "positive",
            "Full": "positive", "Best": "positive", "OK": "positive",
            "Regular": "negative", "Risky": "negative", "No": "negative",
            "Varies": "neutral",
          }
        },
        {
          tabLabel: "Perth Tips",
          type: "tips",
          tips: [
            {
              icon: "ğŸŒŠ",
              title: "Coastal suburb? (Scarborough, Fremantle, Cottesloe)",
              text: "Salt air corrodes standard steel faster. Aluminium slat fencing won't rust and lasts 50+ years â€” worth the extra investment near the coast."
            },
            {
              icon: "ğŸ”¥",
              title: "Hills or bushfire zone? (Kalamunda, Mundaring, Roleystone)",
              text: "Colorbond is non-combustible and meets BAL ratings. Timber fencing is not recommended in bushfire-prone areas. Check your BAL rating with your local council."
            },
            {
              icon: "â˜¢ï¸",
              title: "Got old asbestos fencing (Super 6)?",
              text: "Fosters Fencing holds a licensed asbestos removal ticket. Super 6 and Hardifence are no longer manufactured â€” most people upgrade to Colorbond. Never break asbestos yourself."
            },
          ]
        },
      ],
    },

    // â”€â”€ STEP 2: Size â”€â”€
    {
      id: "size",
      title: "How much fencing?",
      preview: "Length & height",
      input: {
        type: "slider_group",
        sliders: [
          {
            id: "length_m",
            label: "Total length (metres)",
            min: 5,
            max: 100,
            default: 20,
            step: 1,
            unit: "m",
            markers: ["5m", "Small yard ~15m", "Avg ~30m", "100m"],
          },
          {
            id: "height_m",
            label: "Height",
            min: 0,
            max: 3,
            default: 2,
            step: 1,
            unit: "",
            valueMap: [
              { value: 0, label: "0.9m (low)", numericValue: 0.9 },
              { value: 1, label: "1.2m (front fence)", numericValue: 1.2 },
              { value: 2, label: "1.8m (standard)", numericValue: 1.8 },
              { value: 3, label: "2.1m (extra tall)", numericValue: 2.1 },
            ],
            markers: ["0.9m", "1.2m", "1.8m", "2.1m"],
          }
        ]
      },
      hints: [
        {
          tabLabel: "Measuring Tips",
          type: "mixed",
          content: [
            {
              type: "paragraph",
              text: "Walk the fence line and count your steps. Each big step is roughly 1 metre. Or use Google Maps â€” right-click and \"Measure distance\" to get an estimate from above."
            },
            {
              type: "key_point",
              label: "Don't stress about exact numbers",
              text: "This gives you a ballpark. Tim or David will do a proper site measure when they come out â€” it's free, no obligation."
            },
            {
              type: "tip",
              icon: "ğŸ“",
              title: "Typical Perth block sizes",
              text: "Standard 450mÂ² block: ~30m of side/rear fencing. Quarter acre (1,012mÂ²): ~50â€“60m. Duplex or villa: ~15â€“20m."
            }
          ]
        },
        {
          tabLabel: "Dividing Fences",
          type: "mixed",
          content: [
            {
              type: "key_point",
              label: "ğŸ˜ï¸ WA Dividing Fences Act 1961",
              text: "In Western Australia, neighbours generally share the cost of a dividing fence 50/50. You can serve a Fencing Notice on your neighbour to start the process."
            },
            {
              type: "tip",
              icon: "ğŸ’¡",
              title: "Pro tip from Tim & David",
              text: "Have a friendly chat with your neighbour first before going the legal route. Most people are reasonable when you explain the costs and show them options. We can quote both sides if needed."
            }
          ]
        }
      ],
      warnings: [
        {
          condition: "answers.fence_type === 'pool' && getSliderNumeric('height_m') < 1.2",
          icon: "âš ï¸",
          title: "Pool fencing minimum 1.2m",
          text: "By Australian law (AS1926.1), pool fencing must be at least 1.2m high. Heights below this won't pass inspection.",
          style: "error"
        }
      ]
    },

    // â”€â”€ STEP 3: Extras â”€â”€
    {
      id: "extras",
      title: "Any extras?",
      preview: "Gates, removal, etc",
      input: {
        type: "toggle_group",
        toggles: [
          { id: "gate", label: "Single pedestrian gate", icon: "ğŸšª", costHint: "Adds ~$350â€“$600" },
          { id: "drivegate", label: "Double/driveway gate", icon: "ğŸš—", costHint: "Adds ~$800â€“$1,500" },
          { id: "removal", label: "Old fence removal", icon: "ğŸ—‘ï¸", costHint: "Adds ~$15â€“$30/m" },
          { id: "asbestos", label: "Asbestos fence removal (licensed)", icon: "â˜¢ï¸", costHint: "Adds ~$35â€“$60/m" },
          { id: "slope", label: "Sloping block (stepped)", icon: "ğŸ“", costHint: "Adds ~10â€“20% to labour" },
          { id: "plinth", label: "Plinth (gap filler under fence)", icon: "ğŸ§±", costHint: "Adds ~$15â€“$25/m" },
          { id: "lattice", label: "Lattice/slat top extension", icon: "ğŸŒ¿", costHint: "Adds ~$20â€“$35/m" },
        ]
      },
      hints: [
        {
          tabLabel: "What's Included?",
          type: "mixed",
          content: [
            {
              type: "paragraph",
              text: "A standard Fosters Fencing quote includes: posts, rails, panels, cement for footings, and installation on flat ground. Here's what might cost extra:"
            },
            {
              type: "key_point",
              label: "â˜¢ï¸ Asbestos fence (Super 6)?",
              text: "Fosters are licensed for asbestos removal â€” it's one of our specialties. Don't attempt it yourself. Unlicensed removal can result in fines up to $50,000 in WA."
            },
            {
              type: "key_point",
              label: "ğŸª¨ Hitting rock or limestone?",
              text: "Common in Perth â€” especially north of the river. If posts can't be dug in by hand, core drilling is needed at ~$10â€“$20 per post hole. Tim will check on site."
            },
            {
              type: "key_point",
              label: "ğŸ§± Need a retaining wall too?",
              text: "Fosters install engineered panel and post retaining wall systems. Retaining is quoted separately â€” mention it in the notes below and Tim or David will price it up on site."
            }
          ]
        }
      ]
    },
  ],

  // â”€â”€ ESTIMATE DISPLAY â”€â”€
  estimate: {
    title: "Your ballpark price",
    preview: "Based on your selections",
    note: "Supply & install â€¢ incl. GST â€¢ Perth metro â€¢ Final price confirmed after site inspection",
    hints: [
      {
        type: "key_point",
        label: "How accurate is this?",
        text: "This is a rough guide based on average Perth pricing in 2025. Your actual quote depends on soil type, access, specific materials, and the installer. Fosters offer free site inspections â€” no obligation."
      },
      {
        type: "tip",
        icon: "ğŸ“",
        title: "Want the exact number?",
        text: "Drop your details below and Tim or David will be in touch within 24 hours. Or call directly on 08 9343 6595. Over 35 years combined experience â€” no job too big or small."
      }
    ]
  },

  // â”€â”€ PRICING LOGIC â”€â”€
  pricing: {
    unit: "metre",
    unitLabel: "per metre",
    basePriceStep: "fence_type",
    basePrices: {
      colorbond:  { low: 95, high: 130 },
      aluminium:  { low: 180, high: 300 },
      timber:     { low: 120, high: 200 },
      pool:       { low: 200, high: 600 },
      security:   { low: 110, high: 250 },
    },
    quantitySource: "length_m",
    multipliers: [
      {
        source: "height_m",
        type: "value_map",
        values: { 0.9: 0.65, 1.2: 0.8, 1.8: 1.0, 2.1: 1.15 }
      }
    ],
    extras: [
      { id: "gate", type: "fixed", low: 350, high: 600, breakdownLabel: "Pedestrian gate" },
      { id: "drivegate", type: "fixed", low: 800, high: 1500, breakdownLabel: "Driveway gate" },
      { id: "removal", type: "per_unit", lowPerUnit: 15, highPerUnit: 30, breakdownLabel: "Old fence removal" },
      { id: "asbestos", type: "per_unit", lowPerUnit: 35, highPerUnit: 60, breakdownLabel: "Asbestos removal (licensed)" },
      { id: "slope", type: "percentage", lowPercent: 10, highPercent: 20, breakdownLabel: "Sloping block" },
      { id: "plinth", type: "per_unit", lowPerUnit: 15, highPerUnit: 25, breakdownLabel: "Plinths" },
      { id: "lattice", type: "per_unit", lowPerUnit: 20, highPerUnit: 35, breakdownLabel: "Lattice top" },
    ],
    showBreakdown: true,
    displayMode: "from",
    roundTo: 0,
    minimumPrice: 500,
  },

  // â”€â”€ LEAD CAPTURE â”€â”€
  leadCapture: {
    enabled: true,
    title: "Get your actual quote",
    preview: "Free, no obligation",
    heading: "We've got your specs.",
    subheading: "Drop your details and Tim or David will get back to you with an exact price â€” usually within 24 hours.",
    showSummary: true,
    fields: [
      { id: "name", label: "Your name", type: "text", placeholder: "e.g. Dave", required: true },
      { id: "contact", label: "Phone or email", type: "text", placeholder: "e.g. 0412 345 678", required: true },
      { id: "suburb", label: "Suburb", type: "text", placeholder: "e.g. Joondalup, Kingsley, Scarborough", required: false },
      { id: "notes", label: "Anything else we should know?", type: "textarea", placeholder: "e.g. Replacing old asbestos fence, need retaining wall too, dog keeps escaping...", required: false },
    ],
    submitText: "ğŸ“© Send My Quote Request",
    submitNote: "No spam. Just your quote from Fosters Fencing.",
    successMessage: "Quote request sent! âœ…",
    successSubtext: "Tim or David will be in touch within 24 hours with a proper price based on your specs. Or call us now on 08 9343 6595.",
    delivery: {
      method: "web3forms",
      web3formsKey: "99a11c15-5c61-4765-99c5-673adec64b16",
      notifyEmail: "responses@itabs.ai",
      emailSubject: "New Fence Enquiry â€” Fosters Fencing",
    }
  },

  socialProof: {
    enabled: true,
    rating: 5.0,
    reviewCount: 141,
    badges: ["Licensed & Insured", "35+ Yrs Experience", "No Sub-contractors"],
  },

  footer: {
    showPoweredBy: true,
    poweredByUrl: "https://itabs.ai",
  }
};
</script>

<!-- Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â
     ENGINE â€” Everything below here is generic. Do not edit per client.
     Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â -->

<script>
// Load Google Fonts from config
if (WIDGET_CONFIG.branding.googleFontsUrl) {
  const link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = WIDGET_CONFIG.branding.googleFontsUrl;
  document.head.appendChild(link);
  const preconnect = document.createElement('link');
  preconnect.rel = 'preconnect';
  preconnect.href = 'https://fonts.googleapis.com';
  document.head.prepend(preconnect);
}
// Set page title
document.title = WIDGET_CONFIG.header.headline + ' | ' + WIDGET_CONFIG.business.name;
</script>

<style>
/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â CSS VARIABLES â€” Set from config via JS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
:root {
  --bg-main: #0c1117;
  --bg-card: #151c25;
  --bg-hover: #1a2332;
  --bg-dark: #0a0e14;
  --border: #222d3a;
  --brand-primary: #f59e0b;
  --brand-secondary: #d97706;
  --brand-glow: rgba(245, 158, 11, 0.15);
  --accent-green: #22c55e;
  --accent-blue: #3b82f6;
  --accent-red: #ef4444;
  --text-primary: #e8ecf1;
  --text-secondary: #8896a7;
  --text-muted: #5a6a7d;
  --font-main: 'Plus Jakarta Sans', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --radius: 14px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: var(--font-main);
  background: var(--bg-main);
  color: var(--text-primary);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 520px;
  margin: 0 auto;
  padding: 20px 16px 40px;
}

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â HEADER Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.header { text-align: center; padding: 30px 0 25px; }
.header-icon { font-size: 2.5rem; margin-bottom: 12px; }
.header h1 {
  font-size: 1.6rem; font-weight: 800; margin-bottom: 6px;
  background: linear-gradient(135deg, var(--brand-primary), #fbbf24);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.header p { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.5; }
.header .badge-line {
  display: inline-block; background: var(--bg-card); border: 1px solid var(--border);
  padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; color: var(--text-muted); margin-top: 12px;
}

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â PROGRESS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.progress-label {
  display: flex; justify-content: space-between; margin-bottom: 8px;
  font-size: 0.75rem; color: var(--text-muted);
}
.progress-bar {
  background: var(--bg-card); border-radius: 10px; height: 6px; margin-bottom: 25px; overflow: hidden;
}
.progress-fill {
  height: 100%; background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary));
  border-radius: 10px; width: 0%; transition: width 0.5s ease;
}

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â ACCORDION SECTIONS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.itab-section {
  background: var(--bg-card); border-radius: var(--radius); margin-bottom: 14px;
  overflow: hidden; border: 1px solid var(--border); transition: all 0.3s ease; scroll-margin-top: 16px;
}
.itab-section:hover { border-color: rgba(245, 158, 11, 0.3); }
.itab-section.completed { border-color: var(--accent-green); }
.itab-section.completed .itab-number { background: var(--accent-green); }

.itab-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 18px 16px; cursor: pointer; transition: background 0.2s;
}
.itab-header:hover { background: var(--bg-hover); }

.itab-title { display: flex; align-items: center; gap: 12px; }
.itab-number {
  width: 34px; height: 34px;
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  border-radius: 10px; display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 0.85rem; color: #000; flex-shrink: 0;
}
.itab-name { font-size: 1rem; font-weight: 600; }
.itab-preview { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }
.itab-preview .selected { color: var(--accent-green); font-weight: 500; }

.i-button {
  width: 32px; height: 32px;
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  border: none; border-radius: 8px; color: #000; font-weight: 700; font-size: 1rem;
  cursor: pointer; transition: all 0.2s; font-family: serif; font-style: italic; flex-shrink: 0;
}
.i-button:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--brand-glow); }
.i-button.active { background: var(--accent-green); color: white; }

.itab-content { display: none; padding: 0 16px 18px; border-top: 1px solid var(--border); }
.itab-content.show { display: block; animation: fadeInUp 0.3s ease; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â TABS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.tabs {
  display: flex; gap: 6px; padding: 14px 0; border-bottom: 1px solid var(--border);
  margin-bottom: 14px; flex-wrap: wrap;
}
.tab {
  padding: 7px 14px; background: var(--bg-hover); border: none; border-radius: 8px;
  color: var(--text-secondary); cursor: pointer; font-family: var(--font-main);
  font-size: 0.85rem; font-weight: 500; transition: all 0.2s;
}
.tab:hover { color: var(--text-primary); }
.tab.active {
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  color: #000; font-weight: 600;
}
.tab-panel { display: none; }
.tab-panel.show { display: block; }
.tab-panel h3 { color: var(--brand-primary); margin-bottom: 10px; font-size: 1rem; }
.tab-panel p { color: var(--text-secondary); margin-bottom: 12px; line-height: 1.6; font-size: 0.9rem; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â SELECT OPTIONS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.option-grid { display: grid; gap: 10px; margin: 10px 0; }
.option-grid.cols-2 { grid-template-columns: 1fr 1fr; }
.option-card {
  background: var(--bg-dark); border: 2px solid var(--border); border-radius: 12px;
  padding: 16px; cursor: pointer; transition: all 0.2s;
}
.option-card:hover { border-color: var(--brand-primary); background: var(--bg-hover); }
.option-card.selected { border-color: var(--accent-green); background: rgba(34, 197, 94, 0.05); }
.option-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
.option-name { font-weight: 700; font-size: 1rem; }
.option-price { font-family: var(--font-mono); font-size: 0.85rem; color: var(--brand-primary); font-weight: 500; }
.option-desc { color: var(--text-muted); font-size: 0.82rem; line-height: 1.5; }
.option-check { display: none; color: var(--accent-green); font-weight: 700; font-size: 0.85rem; margin-top: 6px; }
.option-card.selected .option-check { display: inline; }
.option-tags { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.option-tag {
  font-size: 0.7rem; padding: 3px 8px; border-radius: 6px;
  background: var(--bg-hover); color: var(--text-muted);
}
.option-tag.highlight { background: rgba(245, 158, 11, 0.15); color: var(--brand-primary); }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â SLIDERS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.slider-group { margin: 16px 0; }
.slider-label { display: flex; justify-content: space-between; margin-bottom: 8px; }
.slider-label span { color: var(--text-secondary); font-size: 0.9rem; }
.slider-value { font-family: var(--font-mono); color: var(--brand-primary); font-weight: 600; }
input[type="range"] {
  width: 100%; -webkit-appearance: none; appearance: none;
  height: 8px; background: var(--bg-dark); border-radius: 4px; outline: none;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 24px; height: 24px;
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  border-radius: 50%; cursor: pointer; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}
input[type="range"]::-moz-range-thumb {
  width: 24px; height: 24px;
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  border-radius: 50%; cursor: pointer; border: none;
}
.slider-markers {
  display: flex; justify-content: space-between; font-size: 0.7rem;
  color: var(--text-muted); margin-top: 4px;
}

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â TOGGLES Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.toggle-row {
  display: flex; justify-content: space-between; align-items: center;
  padding: 14px 0; border-bottom: 1px solid var(--border);
}
.toggle-row:last-child { border-bottom: none; }
.toggle-info .toggle-name { font-weight: 600; font-size: 0.9rem; margin-bottom: 2px; }
.toggle-info .toggle-cost { font-size: 0.8rem; color: var(--text-muted); }
.toggle-switch {
  width: 48px; height: 26px; background: var(--bg-dark); border-radius: 13px;
  border: 2px solid var(--border); cursor: pointer; position: relative;
  transition: all 0.3s; flex-shrink: 0;
}
.toggle-switch.on { background: var(--accent-green); border-color: var(--accent-green); }
.toggle-knob {
  width: 18px; height: 18px; background: white; border-radius: 50%;
  position: absolute; top: 2px; left: 2px; transition: all 0.3s;
}
.toggle-switch.on .toggle-knob { left: 24px; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â ESTIMATE BOX Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.estimate-box {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(217, 119, 6, 0.05));
  border: 2px solid var(--brand-primary); border-radius: var(--radius);
  padding: 24px; margin: 20px 0; text-align: center;
}
.est-label { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.est-range { font-family: var(--font-mono); font-size: 2rem; font-weight: 700; color: var(--brand-primary); margin-bottom: 4px; }
.est-note { color: var(--text-muted); font-size: 0.78rem; }
.estimate-breakdown { margin-top: 16px; text-align: left; }
.breakdown-row {
  display: flex; justify-content: space-between; padding: 8px 0;
  border-bottom: 1px solid rgba(245, 158, 11, 0.1); font-size: 0.85rem;
}
.breakdown-row:last-child { border-bottom: none; }
.breakdown-row .br-label { color: var(--text-secondary); }
.breakdown-row .br-value { font-family: var(--font-mono); color: var(--text-primary); font-weight: 500; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â KEY POINTS & TIPS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.key-point {
  background: var(--bg-dark); border-left: 4px solid var(--brand-primary);
  padding: 12px 16px; margin: 12px 0; border-radius: 0 8px 8px 0;
}
.key-point .kp-label {
  color: var(--brand-primary); font-weight: 600; font-size: 0.75rem;
  text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;
}
.key-point p { color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0; }

.tip-card {
  background: rgba(59, 130, 246, 0.08); border: 1px solid rgba(59, 130, 246, 0.2);
  border-radius: 10px; padding: 12px 14px; margin: 10px 0; font-size: 0.85rem;
}
.tip-card .tip-title { font-weight: 600; color: var(--accent-blue); margin-bottom: 4px; }
.tip-card p { color: var(--text-secondary); margin-bottom: 0; font-size: 0.83rem; }

.warning-card {
  border: 1px solid rgba(239,68,68,0.3); background: rgba(239,68,68,0.08);
  border-radius: 10px; padding: 12px 14px; margin: 10px 0; font-size: 0.85rem;
}
.warning-card .warning-title { font-weight: 600; color: var(--accent-red); margin-bottom: 4px; }
.warning-card p { color: var(--text-secondary); margin-bottom: 0; font-size: 0.83rem; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â COMPARISON TABLE Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.compare-table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 0.82rem; }
.compare-table th {
  text-align: left; padding: 10px 8px; color: var(--text-muted); font-weight: 600;
  border-bottom: 2px solid var(--border); font-size: 0.75rem;
  text-transform: uppercase; letter-spacing: 0.5px;
}
.compare-table td { padding: 10px 8px; color: var(--text-secondary); border-bottom: 1px solid var(--border); }
.compare-table td:first-child { font-weight: 600; color: var(--text-primary); }
.compare-table .positive { color: var(--accent-green); }
.compare-table .negative { color: var(--accent-red); }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â LEAD FORM Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.form-group { margin-bottom: 12px; text-align: left; }
.form-group label { display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 4px; font-weight: 500; }
.form-group input, .form-group textarea {
  width: 100%; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border);
  border-radius: 8px; color: var(--text-primary); font-family: var(--font-main);
  font-size: 0.9rem; outline: none; transition: border-color 0.2s;
}
.form-group input:focus, .form-group textarea:focus { border-color: var(--brand-primary); }
.form-group textarea { resize: vertical; min-height: 70px; }

.submit-btn {
  width: 100%; padding: 14px;
  background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
  border: none; border-radius: 10px; color: #000; font-family: var(--font-main);
  font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.2s; margin-top: 8px;
}
.submit-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 20px var(--brand-glow); }
.submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

.summary-box {
  background: var(--bg-dark); border: 1px solid var(--border); border-radius: 10px;
  padding: 14px; margin-bottom: 16px; font-size: 0.83rem;
}
.summary-label {
  font-weight: 600; color: var(--brand-primary); margin-bottom: 8px;
  font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;
}
.summary-content { color: var(--text-secondary); line-height: 1.8; }

.success-message { text-align: center; padding: 30px 20px; animation: fadeInUp 0.4s ease; }
.success-message .check-icon { font-size: 3rem; margin-bottom: 12px; }
.success-message h3 { color: var(--accent-green); margin-bottom: 8px; }
.success-message p { color: var(--text-secondary); font-size: 0.9rem; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â SOCIAL PROOF Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.social-proof {
  display: flex; align-items: center; justify-content: center; gap: 16px;
  padding: 12px 20px; background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius); flex-wrap: wrap; font-size: 0.85rem;
  color: var(--text-muted); margin-bottom: 20px;
}
.sp-stars { color: var(--brand-primary); letter-spacing: 1px; }
.sp-rating { color: var(--brand-primary); font-weight: 600; }
.sp-badge {
  background: var(--bg-hover); padding: 4px 10px; border-radius: 20px;
  font-size: 0.75rem; white-space: nowrap;
}

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â FOOTER Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
.powered-by {
  text-align: center; padding: 30px 0 10px; font-size: 0.75rem; color: var(--text-muted);
}
.powered-by a { color: var(--brand-primary); text-decoration: none; font-weight: 600; }

/* Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â ANIMATIONS Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<div class="container" id="app">
  <!-- Rendered by engine -->
</div>

<script>
// Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â
// iTabs Quotes Engine v1.0
// Ã¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢ÂÃ¢â€¢Â

const C = WIDGET_CONFIG;

// Ã¢â€â‚¬Ã¢â€â‚¬ STATE Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
const state = {
  answers: {},       // { step_id: value } for selects
  sliders: {},       // { slider_id: { raw, numeric, label } }
  toggles: {},       // { toggle_id: true/false }
  openSection: null,
  completedSections: new Set(),
};

// Ã¢â€â‚¬Ã¢â€â‚¬ APPLY BRANDING Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function applyBranding() {
  const b = C.branding;
  const r = document.documentElement.style;
  r.setProperty('--bg-main', b.backgroundColor);
  r.setProperty('--bg-card', b.cardBackground);
  r.setProperty('--bg-hover', b.hoverBackground);
  r.setProperty('--bg-dark', b.darkBackground);
  r.setProperty('--border', b.borderColor);
  r.setProperty('--brand-primary', b.primaryColor);
  r.setProperty('--brand-secondary', b.secondaryColor);
  r.setProperty('--text-primary', b.textColor);
  r.setProperty('--text-secondary', b.mutedText);
  r.setProperty('--text-muted', b.dimText);
  r.setProperty('--accent-green', b.successColor);
  r.setProperty('--accent-red', b.errorColor);
  r.setProperty('--accent-blue', b.infoColor);
  r.setProperty('--font-main', b.fontFamily);
  r.setProperty('--font-mono', b.monoFont);
  r.setProperty('--radius', b.borderRadius);
}

// Ã¢â€â‚¬Ã¢â€â‚¬ INIT Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function init() {
  applyBranding();
  initSliderDefaults();
  render();
  // Auto-open first section
  setTimeout(() => toggleSection(0), 300);
}

function initSliderDefaults() {
  C.steps.forEach(step => {
    if (step.input.type === 'slider_group') {
      step.input.sliders.forEach(s => {
        const raw = s.default;
        if (s.valueMap) {
          const mapped = s.valueMap.find(v => v.value === raw);
          state.sliders[s.id] = {
            raw, numeric: mapped ? mapped.numericValue : raw, label: mapped ? mapped.label : raw + (s.unit || '')
          };
        } else {
          state.sliders[s.id] = { raw, numeric: raw, label: raw + (s.unit || '') };
        }
      });
    }
    if (step.input.type === 'toggle_group') {
      step.input.toggles.forEach(t => { state.toggles[t.id] = false; });
    }
  });
}

// Ã¢â€â‚¬Ã¢â€â‚¬ RENDER Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function render() {
  const app = document.getElementById('app');
  let html = '';

  // Header
  html += renderHeader();

  // Social proof
  if (C.socialProof && C.socialProof.enabled) html += renderSocialProof();

  // Progress
  const totalSections = C.steps.length + (C.estimate ? 1 : 0) + (C.leadCapture && C.leadCapture.enabled ? 1 : 0);
  html += `
    <div class="progress-label">
      <span>Your quote</span>
      <span id="progressText">0 of ${totalSections}</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>`;

  // Steps
  C.steps.forEach((step, i) => {
    html += renderSection(step, i);
  });

  // Estimate section
  if (C.estimate) {
    html += renderEstimateSection(C.steps.length);
  }

  // Lead capture section
  if (C.leadCapture && C.leadCapture.enabled) {
    html += renderLeadSection(C.steps.length + (C.estimate ? 1 : 0));
  }

  // Footer
  if (C.footer && C.footer.showPoweredBy) {
    html += `<div class="powered-by">Powered by <a href="${C.footer.poweredByUrl}" target="_blank">iTabs</a> Â· Interactive tools that convert</div>`;
  }

  app.innerHTML = html;
}

function renderHeader() {
  const h = C.header;
  return `
    <div class="header">
      <div class="header-icon">${h.icon}</div>
      <h1>${h.headline}</h1>
      <p>${h.subtitle}</p>
      ${h.badge ? `<span class="badge-line">${h.badge}</span>` : ''}
    </div>`;
}

function renderSocialProof() {
  const sp = C.socialProof;
  const stars = '\u2605'.repeat(Math.floor(sp.rating));
  return `
    <div class="social-proof">
      <span class="sp-stars">${stars}</span>
      <span class="sp-rating">${sp.rating} from ${sp.reviewCount} reviews</span>
      ${sp.badges.map(b => `<span class="sp-badge">${b}</span>`).join('')}
    </div>`;
}

// Ã¢â€â‚¬Ã¢â€â‚¬ SECTION RENDERING Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function renderSection(step, index) {
  const sectionId = `section-${index}`;
  const completed = state.completedSections.has(sectionId) ? ' completed' : '';
  const isOpen = state.openSection === sectionId;
  const preview = getPreview(step);

  let contentHtml = '';

  // Build tabs: first tab is always "Choose"/"Set"/"Add", rest from hints
  const inputTabLabel = step.input.type === 'toggle_group' ? 'Add Extras' :
                        step.input.type === 'slider_group' ? 'Set Size' : 'Choose';

  const hintTabs = step.hints || [];
  const hasTabs = hintTabs.length > 0;

  if (hasTabs) {
    contentHtml += `<div class="tabs">`;
    contentHtml += `<button class="tab active" onclick="showTab(this, '${sectionId}-input')">${inputTabLabel}</button>`;
    hintTabs.forEach((hint, hi) => {
      contentHtml += `<button class="tab" onclick="showTab(this, '${sectionId}-hint-${hi}')">${hint.tabLabel}</button>`;
    });
    contentHtml += `</div>`;
  }

  // Input panel
  contentHtml += `<div class="tab-panel show" id="${sectionId}-input">`;
  contentHtml += renderInput(step, sectionId);
  // Warnings
  if (step.warnings) {
    step.warnings.forEach(w => {
      contentHtml += `<div class="warning-card" id="${sectionId}-warning-${w.condition.replace(/[^a-z0-9]/gi,'')}" style="display:none;">
        <div class="warning-title">${w.icon} ${w.title}</div>
        <p>${w.text}</p>
      </div>`;
    });
  }
  contentHtml += `</div>`;

  // Hint panels
  hintTabs.forEach((hint, hi) => {
    contentHtml += `<div class="tab-panel" id="${sectionId}-hint-${hi}">`;
    contentHtml += renderHint(hint);
    contentHtml += `</div>`;
  });

  return `
    <div class="itab-section${completed}" id="${sectionId}">
      <div class="itab-header" onclick="toggleSection(${index})">
        <div class="itab-title">
          <span class="itab-number">${index + 1}</span>
          <div>
            <div class="itab-name">${step.title}</div>
            <div class="itab-preview" id="${sectionId}-preview">${preview}</div>
          </div>
        </div>
        <button class="i-button" id="${sectionId}-btn">i</button>
      </div>
      <div class="itab-content${isOpen ? ' show' : ''}" id="${sectionId}-content">
        ${contentHtml}
      </div>
    </div>`;
}

function renderEstimateSection(index) {
  const sectionId = `section-${index}`;
  const est = C.estimate;
  const isOpen = state.openSection === sectionId;
  const completed = state.completedSections.has(sectionId) ? ' completed' : '';

  let hintsHtml = '';
  if (est.hints) {
    est.hints.forEach(h => { hintsHtml += renderHintItem(h); });
  }

  return `
    <div class="itab-section${completed}" id="${sectionId}">
      <div class="itab-header" onclick="toggleSection(${index})">
        <div class="itab-title">
          <span class="itab-number">${index + 1}</span>
          <div>
            <div class="itab-name">${est.title}</div>
            <div class="itab-preview" id="${sectionId}-preview">${est.preview}</div>
          </div>
        </div>
        <button class="i-button" id="${sectionId}-btn">i</button>
      </div>
      <div class="itab-content${isOpen ? ' show' : ''}" id="${sectionId}-content">
        <div class="estimate-box">
          <div class="est-label">${C.pricing.displayMode === 'from' ? 'Estimated from' : 'Estimated range'}</div>
          <div class="est-range" id="estRange">â€”</div>
          <div class="est-note" id="estNote">Complete the sections above to see your estimate</div>
          <div class="estimate-breakdown" id="estBreakdown"></div>
        </div>
        ${hintsHtml}
      </div>
    </div>`;
}

function renderLeadSection(index) {
  const sectionId = `section-${index}`;
  const lc = C.leadCapture;
  const isOpen = state.openSection === sectionId;
  const completed = state.completedSections.has(sectionId) ? ' completed' : '';

  let fieldsHtml = '';
  lc.fields.forEach(f => {
    const reqMark = f.required ? ' *' : '';
    if (f.type === 'textarea') {
      fieldsHtml += `<div class="form-group"><label>${f.label}${reqMark}</label><textarea id="form-${f.id}" placeholder="${f.placeholder}"></textarea></div>`;
    } else {
      fieldsHtml += `<div class="form-group"><label>${f.label}${reqMark}</label><input type="${f.type}" id="form-${f.id}" placeholder="${f.placeholder}"></div>`;
    }
  });

  return `
    <div class="itab-section${completed}" id="${sectionId}">
      <div class="itab-header" onclick="toggleSection(${index})">
        <div class="itab-title">
          <span class="itab-number">${index + 1}</span>
          <div>
            <div class="itab-name">${lc.title}</div>
            <div class="itab-preview" id="${sectionId}-preview">${lc.preview}</div>
          </div>
        </div>
        <button class="i-button" id="${sectionId}-btn">i</button>
      </div>
      <div class="itab-content${isOpen ? ' show' : ''}" id="${sectionId}-content">
        <div id="leadFormContainer">
          <p style="color:var(--text-secondary);font-size:0.9rem;margin-bottom:16px;">${lc.subheading}</p>
          ${lc.showSummary ? `
            <div class="summary-box">
              <div class="summary-label">Your specs</div>
              <div class="summary-content" id="quoteSummary">Select your options above first</div>
            </div>` : ''}
          ${fieldsHtml}
          <button class="submit-btn" id="submitBtn" onclick="submitLead()">${lc.submitText}</button>
          ${lc.submitNote ? `<div style="text-align:center;margin-top:12px;font-size:0.75rem;color:var(--text-muted)">${lc.submitNote}</div>` : ''}
        </div>
        <div class="success-message" id="successMsg" style="display:none;">
          <div class="check-icon">âœ…</div>
          <h3>${lc.successMessage}</h3>
          <p>${lc.successSubtext}</p>
        </div>
      </div>
    </div>`;
}

// Ã¢â€â‚¬Ã¢â€â‚¬ INPUT RENDERING Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function renderInput(step, sectionId) {
  const input = step.input;
  switch (input.type) {
    case 'select': return renderSelect(step, sectionId, input);
    case 'multi_select': return renderMultiSelect(step, sectionId, input);
    case 'slider_group': return renderSliders(step, sectionId, input);
    case 'toggle_group': return renderToggles(step, sectionId, input);
    default: return '<p>Unknown input type</p>';
  }
}

function renderSelect(step, sectionId, input) {
  const colsClass = input.columns === 2 ? ' cols-2' : '';
  let html = `<div class="option-grid${colsClass}">`;
  input.options.forEach((opt, i) => {
    const selected = state.answers[step.id] === opt.value ? ' selected' : '';
    const tagsHtml = opt.tags ? opt.tags.map(t =>
      `<span class="option-tag${t.highlight ? ' highlight' : ''}">${t.text}</span>`
    ).join('') : '';
    html += `
      <div class="option-card${selected}" onclick="selectOption('${step.id}', '${opt.value}', ${C.steps.indexOf(step)}, ${input.autoAdvance || false})">
        <div class="option-top">
          <span class="option-name">${opt.icon} ${opt.label}</span>
          ${opt.priceHint ? `<span class="option-price">${opt.priceHint}</span>` : ''}
        </div>
        ${opt.description ? `<div class="option-desc">${opt.description}</div>` : ''}
        ${tagsHtml ? `<div class="option-tags">${tagsHtml}</div>` : ''}
        <span class="option-check">âœ“ Selected</span>
      </div>`;
  });
  html += '</div>';
  return html;
}

function renderMultiSelect(step, sectionId, input) {
  // Similar to select but with multi-selection
  const colsClass = input.columns === 2 ? ' cols-2' : '';
  if (!state.answers[step.id]) state.answers[step.id] = [];
  let html = `<div class="option-grid${colsClass}">`;
  input.options.forEach(opt => {
    const selected = state.answers[step.id].includes(opt.value) ? ' selected' : '';
    html += `
      <div class="option-card${selected}" onclick="toggleMultiOption('${step.id}', '${opt.value}', this)">
        <div class="option-top">
          <span class="option-name">${opt.icon} ${opt.label}</span>
          ${opt.priceHint ? `<span class="option-price">${opt.priceHint}</span>` : ''}
        </div>
        ${opt.description ? `<div class="option-desc">${opt.description}</div>` : ''}
        <span class="option-check">âœ“ Selected</span>
      </div>`;
  });
  html += '</div>';
  if (input.optional) {
    html += `<button class="tab" style="margin-top:10px;width:100%;text-align:center;" onclick="skipStep(${C.steps.indexOf(step)})">Skip â€” none needed</button>`;
  }
  return html;
}

function renderSliders(step, sectionId, input) {
  let html = '';
  input.sliders.forEach(s => {
    const current = state.sliders[s.id];
    const displayValue = current ? current.label : s.default + (s.unit || '');
    html += `
      <div class="slider-group">
        <div class="slider-label">
          <span>${s.label}</span>
          <span class="slider-value" id="slider-val-${s.id}">${displayValue}</span>
        </div>
        <input type="range" id="slider-${s.id}" min="${s.min}" max="${s.max}" value="${s.default}" step="${s.step}"
               oninput="updateSlider('${s.id}', '${step.id}', ${C.steps.indexOf(step)}, this.value)">
        ${s.markers ? `<div class="slider-markers">${s.markers.map(m => `<span>${m}</span>`).join('')}</div>` : ''}
      </div>`;
  });
  return html;
}

function renderToggles(step, sectionId, input) {
  let html = '';
  input.toggles.forEach(t => {
    const isOn = state.toggles[t.id] ? ' on' : '';
    html += `
      <div class="toggle-row">
        <div class="toggle-info">
          <div class="toggle-name">${t.icon} ${t.label}</div>
          <div class="toggle-cost">${t.costHint}</div>
        </div>
        <div class="toggle-switch${isOn}" id="toggle-${t.id}" onclick="toggleExtra('${t.id}', '${step.id}', ${C.steps.indexOf(step)})">
          <div class="toggle-knob"></div>
        </div>
      </div>`;
  });
  return html;
}

// Ã¢â€â‚¬Ã¢â€â‚¬ HINT RENDERING Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function renderHint(hint) {
  switch (hint.type) {
    case 'comparison_table': return renderComparisonTable(hint);
    case 'tips': return renderTips(hint);
    case 'mixed': return renderMixed(hint);
    case 'custom_html': return hint.content;
    default: return '';
  }
}

function renderComparisonTable(hint) {
  let html = '<table class="compare-table"><thead><tr>';
  hint.columns.forEach(c => { html += `<th>${c}</th>`; });
  html += '</tr></thead><tbody>';
  hint.rows.forEach(row => {
    html += '<tr>';
    row.forEach((cell, i) => {
      const style = hint.cellStyles && hint.cellStyles[cell];
      const cls = style ? ` class="${style}"` : '';
      html += `<td${cls}>${cell}</td>`;
    });
    html += '</tr>';
  });
  html += '</tbody></table>';
  return html;
}

function renderTips(hint) {
  return hint.tips.map(t => `
    <div class="tip-card">
      <div class="tip-title">${t.icon} ${t.title}</div>
      <p>${t.text}</p>
    </div>`).join('');
}

function renderMixed(hint) {
  return hint.content.map(item => renderHintItem(item)).join('');
}

function renderHintItem(item) {
  switch (item.type) {
    case 'paragraph':
      return `<p style="color:var(--text-secondary);font-size:0.9rem;line-height:1.6;margin-bottom:12px;">${item.text}</p>`;
    case 'key_point':
      return `<div class="key-point"><div class="kp-label">${item.label}</div><p>${item.text}</p></div>`;
    case 'tip':
      return `<div class="tip-card"><div class="tip-title">${item.icon} ${item.title}</div><p>${item.text}</p></div>`;
    default:
      return '';
  }
}

// Ã¢â€â‚¬Ã¢â€â‚¬ INTERACTIONS Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function toggleSection(index) {
  const sectionId = `section-${index}`;
  const content = document.getElementById(sectionId + '-content');
  const btn = document.getElementById(sectionId + '-btn');
  const isOpen = content && content.classList.contains('show');

  // Close all
  document.querySelectorAll('.itab-content').forEach(c => c.classList.remove('show'));
  document.querySelectorAll('.i-button').forEach(b => b.classList.remove('active'));

  if (!isOpen && content) {
    content.classList.add('show');
    if (btn) btn.classList.add('active');
    state.openSection = sectionId;
    state.completedSections.add(sectionId);
    updateProgress();

    setTimeout(() => {
      document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  } else {
    state.openSection = null;
  }
}

function showTab(btn, panelId) {
  const container = btn.closest('.itab-content');
  container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  container.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('show'));
  btn.classList.add('active');
  document.getElementById(panelId).classList.add('show');
}

function selectOption(stepId, value, stepIndex, autoAdvance) {
  state.answers[stepId] = value;
  const sectionId = `section-${stepIndex}`;

  // Update visual selection
  const section = document.getElementById(sectionId);
  section.querySelectorAll(`#${sectionId}-input .option-card`).forEach(c => c.classList.remove('selected'));
  // Find and select the right one
  const cards = section.querySelectorAll(`#${sectionId}-input .option-card`);
  const step = C.steps[stepIndex];
  step.input.options.forEach((opt, i) => {
    if (opt.value === value && cards[i]) cards[i].classList.add('selected');
  });

  // Mark completed
  section.classList.add('completed');
  state.completedSections.add(sectionId);

  // Update preview
  const opt = step.input.options.find(o => o.value === value);
  document.getElementById(sectionId + '-preview').innerHTML = `<span class="selected">âœ“ ${opt ? opt.label : value}</span>`;

  updateEstimate();
  updateQuoteSummary();
  updateProgress();
  checkWarnings();

  if (autoAdvance) {
    setTimeout(() => toggleSection(stepIndex + 1), 400);
  }
}

function toggleMultiOption(stepId, value, el) {
  if (!state.answers[stepId]) state.answers[stepId] = [];
  const idx = state.answers[stepId].indexOf(value);
  if (idx > -1) {
    state.answers[stepId].splice(idx, 1);
    el.classList.remove('selected');
  } else {
    state.answers[stepId].push(value);
    el.classList.add('selected');
  }
  updateEstimate();
  updateQuoteSummary();
}

function updateSlider(sliderId, stepId, stepIndex, rawValue) {
  const step = C.steps[stepIndex];
  const sliderConfig = step.input.sliders.find(s => s.id === sliderId);
  const raw = parseFloat(rawValue);

  if (sliderConfig.valueMap) {
    const mapped = sliderConfig.valueMap.find(v => v.value === raw);
    state.sliders[sliderId] = {
      raw, numeric: mapped ? mapped.numericValue : raw, label: mapped ? mapped.label : raw + (sliderConfig.unit || '')
    };
  } else {
    state.sliders[sliderId] = { raw, numeric: raw, label: raw + (sliderConfig.unit || '') };
  }

  // Update display
  document.getElementById(`slider-val-${sliderId}`).textContent = state.sliders[sliderId].label;

  // Mark completed & update preview
  const sectionId = `section-${stepIndex}`;
  document.getElementById(sectionId).classList.add('completed');
  state.completedSections.add(sectionId);

  // Build preview from all sliders in this step
  const previews = step.input.sliders.map(s => {
    const val = state.sliders[s.id];
    if (s.valueMap) return val.numeric + 'm';
    return val.raw + (s.unit || '');
  });
  document.getElementById(sectionId + '-preview').innerHTML = `<span class="selected">âœ“ ${previews.join(' Ã— ')}</span>`;

  updateEstimate();
  updateQuoteSummary();
  updateProgress();
  checkWarnings();
}

function toggleExtra(toggleId, stepId, stepIndex) {
  state.toggles[toggleId] = !state.toggles[toggleId];
  const el = document.getElementById(`toggle-${toggleId}`);
  el.classList.toggle('on');

  // Update preview
  const sectionId = `section-${stepIndex}`;
  const step = C.steps[stepIndex];
  const activeCount = step.input.toggles.filter(t => state.toggles[t.id]).length;

  if (activeCount > 0) {
    document.getElementById(sectionId + '-preview').innerHTML =
      `<span class="selected">âœ“ ${activeCount} extra${activeCount > 1 ? 's' : ''} added</span>`;
    document.getElementById(sectionId).classList.add('completed');
    state.completedSections.add(sectionId);
  } else {
    document.getElementById(sectionId + '-preview').textContent = step.preview;
    document.getElementById(sectionId).classList.remove('completed');
    state.completedSections.delete(sectionId);
  }

  updateEstimate();
  updateQuoteSummary();
  updateProgress();
}

function skipStep(stepIndex) {
  toggleSection(stepIndex + 1);
}

// Ã¢â€â‚¬Ã¢â€â‚¬ PRICING ENGINE Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function getSliderNumeric(sliderId) {
  return state.sliders[sliderId] ? state.sliders[sliderId].numeric : 0;
}

function calculateEstimate() {
  const p = C.pricing;

  // Get base price from primary selection
  const primaryAnswer = state.answers[p.basePriceStep];
  if (!primaryAnswer || !p.basePrices[primaryAnswer]) return null;

  const base = p.basePrices[primaryAnswer];
  let low = base.low;
  let high = base.high;

  // Apply multipliers
  if (p.multipliers) {
    p.multipliers.forEach(m => {
      if (m.type === 'value_map') {
        const numericVal = getSliderNumeric(m.source);
        const mult = m.values[numericVal];
        if (mult !== undefined) {
          low *= mult;
          high *= mult;
        }
      }
    });
  }

  // Apply adjustments (additive from select steps)
  if (p.adjustments) {
    p.adjustments.forEach(adj => {
      const answer = state.answers[adj.source];
      if (answer && adj.type === 'additive') {
        const val = adj.values[answer] !== undefined ? adj.values[answer] : (adj.values._default || 0);
        low += val;
        high += val;
      }
    });
  }

  // Multiply by quantity
  const quantity = state.sliders[p.quantitySource] ? state.sliders[p.quantitySource].numeric : 1;
  low = Math.round(low * quantity);
  high = Math.round(high * quantity);

  // Build breakdown
  const breakdown = [];
  const primaryOpt = findOption(p.basePriceStep, primaryAnswer);
  const primaryLabel = primaryOpt ? primaryOpt.label : primaryAnswer;

  // Base line
  let baseLine = primaryLabel;
  if (p.quantitySource && state.sliders[p.quantitySource]) {
    baseLine += ` (${state.sliders[p.quantitySource].raw}${getSliderUnit(p.quantitySource)}`;
    // Add other slider values to label
    const baseStep = C.steps.find(s => s.input.type === 'slider_group' && s.input.sliders.some(sl => sl.id === p.quantitySource));
    if (baseStep) {
      baseStep.input.sliders.forEach(s => {
        if (s.id !== p.quantitySource && state.sliders[s.id]) {
          baseLine += ` Ã— ${state.sliders[s.id].numeric}m`;
        }
      });
    }
    baseLine += ')';
  }
  breakdown.push({ label: baseLine, low, high });

  // Extras
  let runningLow = low;
  let runningHigh = high;

  if (p.extras) {
    p.extras.forEach(extra => {
      if (!state.toggles[extra.id]) return;

      let extLow = 0, extHigh = 0;
      switch (extra.type) {
        case 'fixed':
          extLow = extra.low;
          extHigh = extra.high;
          break;
        case 'per_unit':
          extLow = Math.round(extra.lowPerUnit * quantity);
          extHigh = Math.round(extra.highPerUnit * quantity);
          break;
        case 'percentage':
          extLow = Math.round(runningLow * (extra.lowPercent / 100));
          extHigh = Math.round(runningHigh * (extra.highPercent / 100));
          break;
      }
      runningLow += extLow;
      runningHigh += extHigh;
      breakdown.push({ label: extra.breakdownLabel, low: extLow, high: extHigh, prefix: extra.type === 'percentage' ? '+' : '' });
    });
  }

  // Apply minimum
  runningLow = Math.max(runningLow, p.minimumPrice || 0);
  runningHigh = Math.max(runningHigh, p.minimumPrice || 0);

  // Round
  if (p.roundTo && p.roundTo > 0) {
    runningLow = Math.round(runningLow / p.roundTo) * p.roundTo;
    runningHigh = Math.round(runningHigh / p.roundTo) * p.roundTo;
  }

  return { low: runningLow, high: runningHigh, breakdown };
}

function findOption(stepId, value) {
  const step = C.steps.find(s => s.id === stepId);
  if (!step) return null;
  return step.input.options ? step.input.options.find(o => o.value === value) : null;
}

function getSliderUnit(sliderId) {
  for (const step of C.steps) {
    if (step.input.type === 'slider_group') {
      const s = step.input.sliders.find(sl => sl.id === sliderId);
      if (s) return s.unit || '';
    }
  }
  return '';
}

function formatPrice(low, high, prefix, isTotal) {
  prefix = prefix || '';
  if (C.pricing.displayMode === 'from') {
    return `${prefix ? '+ ' : ''}${isTotal ? 'From ' : ''}$${low.toLocaleString()}`;
  }
  return `${prefix}$${low.toLocaleString()} â€“ $${high.toLocaleString()}`;
}

function updateEstimate() {
  const est = calculateEstimate();
  const rangeEl = document.getElementById('estRange');
  const noteEl = document.getElementById('estNote');
  const breakdownEl = document.getElementById('estBreakdown');
  const estSectionIndex = C.steps.length;
  const previewEl = document.getElementById(`section-${estSectionIndex}-preview`);

  if (!rangeEl) return; // Not yet rendered

  if (!est) {
    rangeEl.textContent = 'â€”';
    noteEl.textContent = 'Complete the sections above to see your estimate';
    breakdownEl.innerHTML = '';
    if (previewEl) previewEl.textContent = C.estimate.preview;
    return;
  }

  const rangeText = formatPrice(est.low, est.high, '', true);
  rangeEl.textContent = rangeText;
  noteEl.textContent = C.estimate.note;

  if (C.pricing.showBreakdown && est.breakdown) {
    breakdownEl.innerHTML = est.breakdown.map(b => `
      <div class="breakdown-row">
        <span class="br-label">${b.label}</span>
        <span class="br-value">${formatPrice(b.low, b.high, b.prefix)}</span>
      </div>`).join('');
  }

  if (previewEl) {
    previewEl.innerHTML = `<span class="selected">âœ“ ${rangeText}</span>`;
  }
}

// Ã¢â€â‚¬Ã¢â€â‚¬ QUOTE SUMMARY Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function updateQuoteSummary() {
  const el = document.getElementById('quoteSummary');
  if (!el) return;

  let lines = [];

  C.steps.forEach(step => {
    if (step.input.type === 'select' && state.answers[step.id]) {
      const opt = findOption(step.id, state.answers[step.id]);
      lines.push(`${opt ? opt.icon : 'â€¢'} ${step.title}: <strong>${opt ? opt.label : state.answers[step.id]}</strong>`);
    }
    if (step.input.type === 'slider_group') {
      const vals = step.input.sliders.map(s => {
        const v = state.sliders[s.id];
        return v ? v.label : '';
      }).filter(Boolean);
      if (vals.length) lines.push(`Ã°Å¸â€œÂ ${step.title}: <strong>${vals.join(' Ã— ')}</strong>`);
    }
    if (step.input.type === 'toggle_group') {
      const active = step.input.toggles.filter(t => state.toggles[t.id]);
      if (active.length) {
        lines.push(`â• Extras: ${active.map(t => t.icon + ' ' + t.label).join(', ')}`);
      }
    }
  });

  const est = calculateEstimate();
  if (est) {
    lines.push(`ğŸ’° Estimate: <strong>${formatPrice(est.low, est.high, '', true)}</strong>`);
  }

  el.innerHTML = lines.length ? lines.join('<br>') : 'Select your options above first';
}

// Ã¢â€â‚¬Ã¢â€â‚¬ WARNINGS Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function checkWarnings() {
  const answers = state.answers;
  C.steps.forEach((step, i) => {
    if (!step.warnings) return;
    step.warnings.forEach(w => {
      const elId = `section-${i}-warning-${w.condition.replace(/[^a-z0-9]/gi,'')}`;
      const el = document.getElementById(elId);
      if (!el) return;
      try {
        const show = eval(w.condition);
        el.style.display = show ? 'block' : 'none';
      } catch(e) {
        el.style.display = 'none';
      }
    });
  });
}

// Ã¢â€â‚¬Ã¢â€â‚¬ PROGRESS Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function updateProgress() {
  const totalSections = C.steps.length + (C.estimate ? 1 : 0) + (C.leadCapture && C.leadCapture.enabled ? 1 : 0);
  const completed = state.completedSections.size;
  const pct = (completed / totalSections) * 100;
  const fillEl = document.getElementById('progressFill');
  const textEl = document.getElementById('progressText');
  if (fillEl) fillEl.style.width = pct + '%';
  if (textEl) textEl.textContent = `${completed} of ${totalSections}`;
}

// Ã¢â€â‚¬Ã¢â€â‚¬ LEAD SUBMISSION Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
async function submitLead() {
  const lc = C.leadCapture;
  const formData = {};
  let missingRequired = false;

  lc.fields.forEach(f => {
    const el = document.getElementById(`form-${f.id}`);
    const val = el ? el.value.trim() : '';
    formData[f.id] = val;
    if (f.required && !val) missingRequired = true;
  });

  if (missingRequired) {
    alert('Just need the required fields filled in Ã°Å¸â€˜Â');
    return;
  }

  const btn = document.getElementById('submitBtn');
  btn.textContent = 'Sending...';
  btn.disabled = true;

  // Build selections summary
  let selections = '';
  C.steps.forEach(step => {
    if (step.input.type === 'select' && state.answers[step.id]) {
      const opt = findOption(step.id, state.answers[step.id]);
      selections += `${step.title}: ${opt ? opt.label : state.answers[step.id]}\n`;
    }
    if (step.input.type === 'slider_group') {
      const vals = step.input.sliders.map(s => `${s.label}: ${state.sliders[s.id] ? state.sliders[s.id].label : ''}`);
      selections += vals.join(', ') + '\n';
    }
    if (step.input.type === 'toggle_group') {
      const active = step.input.toggles.filter(t => state.toggles[t.id]).map(t => t.label);
      if (active.length) selections += `Extras: ${active.join(', ')}\n`;
    }
  });

  const est = calculateEstimate();
  const estText = est ? formatPrice(est.low, est.high, '', true) : 'Not calculated';

  try {
    if (lc.delivery.method === 'web3forms') {
      const payload = {
        access_key: lc.delivery.web3formsKey,
        subject: lc.delivery.emailSubject.replace('{business.name}', C.business.name),
        from_name: `${C.business.name} Quote Widget`,
        to: lc.delivery.notifyEmail,
        message: `NEW QUOTE ENQUIRY\n==================\n${Object.entries(formData).map(([k,v]) => `${k}: ${v}`).join('\n')}\n\nSELECTIONS\n==================\n${selections}\nESTIMATE SHOWN: ${estText}`.trim(),
        ...formData,
        estimate_range: estText,
        selections_summary: selections,
      };

      await fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });
    }
  } catch (err) {
    console.error('Submit error:', err);
  }

  // Show success regardless (better UX)
  document.getElementById('leadFormContainer').style.display = 'none';
  document.getElementById('successMsg').style.display = 'block';

  const leadSectionIndex = C.steps.length + (C.estimate ? 1 : 0);
  const sectionId = `section-${leadSectionIndex}`;
  document.getElementById(sectionId).classList.add('completed');
  state.completedSections.add(sectionId);
  document.getElementById(sectionId + '-preview').innerHTML = '<span class="selected">âœ“ Sent!</span>';
  updateProgress();
}

// Ã¢â€â‚¬Ã¢â€â‚¬ PREVIEW HELPERS Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
function getPreview(step) {
  if (step.input.type === 'select' && state.answers[step.id]) {
    const opt = step.input.options.find(o => o.value === state.answers[step.id]);
    return `<span class="selected">âœ“ ${opt ? opt.label : state.answers[step.id]}</span>`;
  }
  return step.preview;
}

// Ã¢â€â‚¬Ã¢â€â‚¬ GO Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬Ã¢â€â‚¬
init();
</script>

</body>
</html>
